import "@nomiclabs/hardhat-ethers";
import { ethers, network, upgrades } from "hardhat" 
import { expect } from "chai"
import { BigNumber, BigNumberish } from "@ethersproject/bignumber";
import * as utils from './utils'
import * as user from './user'
import * as deposit from './deposit'
import * as withdraw from './withdraw'
import * as deploy from './deploy'
import * as block from './block'

import './config'

import {
	VerifierFactory,
	Verifier,
	PerpetualFactory,
	Perpetual,
	TrustForwarderFactory,
	DepositProxyFactory,
	TrustForwarder,
	DepositProxy,
	ExchangeFactory,
	TokenExchangeProxy,
	TokenExchangeProxyFactory
  } from "../typechain"

import
{
	owners,
	owner, owner_l2_privkey, owner_l2_validium_pubkey, owner_l2_rollup_pubkey,
	other,
	at,
	ot,
	curAccountRoot,
	curOrderStateHash,
	genesisGovernor,
	userAdmin,
	systemToken,
	dacs,
	globalConfig,
	init_config
} from "./config";

import * as config from "./config"
import { Sender} from "./sender";
import { Watcher } from "./watcher";
import { Core } from "./core";
import { Api } from "./api";
import { exit } from "process";
import { is_hardhat_local_network, readEnv } from "./utils/common";
import { DB } from "./db";

describe("All Contract Test", function() {
	this.timeout(6000000);

	let v : Verifier
	let p : Perpetual
	let tf : TrustForwarder
	let dp : DepositProxy
	let tep : TokenExchangeProxy

	let watcher : Watcher
	let api : Api
	let core : Core
	let sender : Sender

	let block1 : block.Block
	let block2 : block.Block
	before(async () => {
		await init_config(DB)
		block1 = new block.Block(at, ot)
		block2 = new block.Block(at, ot)
	});

	it("Deploy", async function() {
		await deploy.deployAll(
			owner,
			genesisGovernor,
			curAccountRoot,
			curOrderStateHash,
			dacs,
			systemToken,
			userAdmin,
			globalConfig.normallizeAssets()
		)
	});

	it("Block State", async function() {
		[v, p] = await utils.common.restoreFromEnv(owner)
		tf = TrustForwarderFactory.connect(readEnv("TRUST_FOWRADER"), owner)
		dp = DepositProxyFactory.connect(readEnv("DEPOSIT_PROXY"), owner)
		tep = TokenExchangeProxyFactory.connect(readEnv("EXCHANGE_PROXY"), owner)

		expect(await (await p.callStatic.accountRoot()).toLowerCase()).equal(curAccountRoot.toLowerCase())

		expect(await p.dacNum()).equal(dacs.length)
		for await (const member of dacs) {
			expect(await p.dacs(member)).equal(true)
		}

		console.log("globalConfigHash : ", await p.globalConfigHash())
	});

	it("Update Dac", async function() {
		if (is_hardhat_local_network()) {
			if ((await p.DacRegisterTime()).eq(0)) {
				let member = "0x9fC4a6c822627ba97674573660d43275B312000E"
				expect(await p.dacs(member)).equal(false)
				await (await p.regDac(member)).wait()
				await (await p.updateDac()).wait()
				expect(await p.dacs(member)).equal(true)
				console.log("add Dac Memeber ", member)
				await (await p.deleteDac(member)).wait()
				expect(await p.dacs(member)).equal(false)
				console.log("delete Dac Memeber ", member)
			}

		}
	});

	it("Init Backend", async function() {
		watcher = new Watcher(p, DB, at)
		api = new Api(DB)
		sender = new Sender(DB, p, owner, owners)
		core = new Core(DB, at, ot)
	});

	it("User Register", async function() {
		await user.register(owner.address, [owner_l2_validium_pubkey, owner_l2_rollup_pubkey], p, owner)
	});

	it("User Register2", async function() {
		await user.register(
			"0xDE5599e5eE1EB71267915Cd683042c0CcBFfDcf3",
			[
				"1001097811318983821818768781613178065837094334583",
				"821660987282093950409284533341248009502279430221"
			],
			p, owner)
	});

	let amount = BigNumber.from(6660000000)
	it("DepositERC20", async function() {
		await deposit.deposit(p, owner_l2_validium_pubkey, amount, systemToken)
	});

	it("Deposit Cancel", async function() {
		await deposit.depositCancel(p, owner_l2_validium_pubkey)
	});

	it("Deposit Reclaim Before Timelock Reach", async function() {
		let REVERT_REASON_HEADER = "Error: VM Exception while processing transaction: reverted with reason string "
		let REVERT_REASON = REVERT_REASON_HEADER + "\'" + "dl" + "\'"
		try {
			await deposit.depositReclaim(p, owner_l2_validium_pubkey, amount, systemToken)
		} catch (error) {
		  	expect(error.toString().includes(REVERT_REASON)).equal(true)
		}
	});


	it("Listen/Process Layer1 Deposit/Cancel/Reclaim", async function() {
		const ts1 = (await owner.provider.getBlock(await owner.provider.getBlockNumber())).timestamp
		await network.provider.send("evm_increaseTime", [process.env.DEPOSIT_CANCEL_TIMELOCK])
		await network.provider.send("evm_mine")
		const ts2 = (await owner.provider.getBlock(await owner.provider.getBlockNumber())).timestamp
		console.log("increase block timestap ", ts2 -ts1)
	});

	it("Deposit Reclaim After Timelock Reach", async function() {
		await deposit.depositReclaim(p, owner_l2_validium_pubkey, amount, systemToken)
	});

	it("Deposit For Withdraw", async function() {
		//exit(0)
		// layer1 activity
		await deposit.deposit(p, owner_l2_validium_pubkey, amount, systemToken)
	});

	it("Watcher Listen/Process Layer1 User Register/Deposit", async function() {
		await watcher.listen()
		let transactions = await watcher.process()
		// [TODO async process in watcher] layer2 process
		await core.addTransToBlock(block1, transactions)
	});

	it("Withdraw In Layer2", async function() {
		let t = api.withdraw(owner_l2_validium_pubkey, amount, 0)
		await core.addTransToBlock(block2, [t])
	});

	it("Update State Block1", async function() {
		await (await p.setValidator(owner.address, true)).wait()
		await sender.sendBlocks([block1, block2])
	});

	it("Withdraw & WithdrawTo In Layer1", async function() {
		await withdraw.withdraw(p, owner_l2_validium_pubkey, amount, systemToken,
			new Date().getTime() % 2 ? undefined : other.address)
	});

	// it("Register & Deposit", async function() {
	// 	await (await systemToken.approve(p.address, amount)).wait()
	// 	await user.registerAndDeposit(owner.address, [owner_l2_validium_pubkey, owner_l2_rollup_pubkey], p,
	// 		owner, [0, 1], [amount.div(4), amount.div(4).mul(3)])
	// });

	it("Deposit 0-gas", async function() {
	});

	it("Deposit ETH", async function() {
    	let ex = await (new ExchangeFactory(owner)).deploy(systemToken.address)
		await (await systemToken.transfer(ex.address, 10000)).wait()

		let exchangeData = (await ex.populateTransaction.sellEthForTokenToUniswapV3("0x", 1000, ethers.constants.AddressZero)).data
		let exchangeProxyData = ethers.utils.defaultAbiCoder.encode(
			[ "address", "address", "uint256", "address", "bytes"],
			[
				ethers.constants.AddressZero,
				ethers.constants.AddressZero,
				1000,
				ex.address,
				exchangeData
			]
		)
		
		let balance_before = await systemToken.balanceOf(p.address)
		await (await dp.depositEth(
			owner_l2_rollup_pubkey,
			tep.address,
			exchangeProxyData,
			"0x"
		)).wait()
		expect(await systemToken.balanceOf(p.address)).eq(balance_before.add(1000))
	});

	// it("Deposit Non_USDC ERC20", async function() {
    // 	let ex = await (new ExchangeFactory(owner)).deploy(systemToken.address)
	// 	await (await systemToken.transfer(ex.address, 10000)).wait()
	// 	let exchangeData = (await ex.populateTransaction.sellTokenForTokenToUniswapV3(
	// 		"0x", 1000, 1000, ethers.constants.AddressZero)).data
	// 	let exchangeProxyData = ethers.utils.defaultAbiCoder.encode(
	// 		[ "address", "address", "uint256", "address", "bytes"],
	// 		[
	// 			ethers.constants.AddressZero,
	// 			ethers.constants.AddressZero,
	// 			1000,
	// 			ex.address,
	// 			exchangeData
	// 		]
	// 	)

	// 	let otherToken = await(new XmTokenFactory(owner)).deploy(100000)
	// 	otherToken.transfer(owner.address, 10000)

	// 	let balance_before = await systemToken.balanceOf(p.address)
	// 	await (await dp.depositERC20(
	// 		otherToken.address,
	// 		1000,
	// 		owner_l2_rollup_pubkey,
	// 		tep.address,
	// 		exchangeProxyData,
	// 		"0x"
	// 	)).wait()
	// 	expect(await systemToken.balanceOf(p.address)).eq(balance_before.add(1000))
		
	// });

	it("upgrade ", async function() {
		console.log("Old Target ", await upgrades.erc1967.getImplementationAddress(p.address))
		const pf = new PerpetualFactory(owner)
		let np = await upgrades.upgradeProxy(
			readEnv("PERPETUAL"),
			pf);
		// console.log(await upgrades.admin.getInstance())
		// console.log(await upgrades.erc1967.getAdminAddress(np.address))
		// console.log(await upgrades.erc1967.getBeaconAddress(ng.address))
		console.log("Upgrade To ", await upgrades.erc1967.getImplementationAddress(p.address))
	});

	it("Recovery Wrong Token ETH", async function() {
		const amount = 999
		await (await owner.sendTransaction({
			to : p.address,
			value : amount
		})).wait()

		const eth_before = await ethers.provider.getBalance(p.address)
		await (await p.recoverWrongToken(ethers.constants.AddressZero, amount)).wait()
		const eth_after = await ethers.provider.getBalance(p.address)
		expect(eth_before.sub(amount)).eq(eth_after)
	});

	it("Add Synthetic Assets", async function() {
		let oldGlobalConfigEncode = globalConfig.encode()
		// 0x980ace57e7f8857e2891e526f7216eb1ee30aac988fd34d37805b4b073d9607c
		//let asset = globalConfig.addAsset(20, 1000000, 100, ethers.utils.toUtf8Bytes("SOL-USD"), 3, owner.address)
		let asset = globalConfig.addAsset(13, 1000000, 128849019, ethers.utils.toUtf8Bytes("MATICUSDC"), 3, "0x9158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d66")
		await p.addSyntheticAssets(
			[
				asset.normalize()
			],
			oldGlobalConfigEncode,
			0
		)
		
		const calldata = p.interface.encodeFunctionData(
			"addSyntheticAssets",
			[
				[
					asset.normalize()
				],
				oldGlobalConfigEncode,
				0
			]
		)
		console.log("add synethtic calldata : ", calldata)

		await (await p.changeGovernor(other.address)).wait()
		let REVERT_REASON_HEADER = "Error: VM Exception while processing transaction: reverted with reason string "
		let REVERT_REASON = REVERT_REASON_HEADER + "\'" + "require Governor" + "\'"
		try {
		  await p.addSyntheticAssets(
			[
				asset.normalize()
			],
			oldGlobalConfigEncode,
			0
		)
		} catch (error) {
		  expect(error.toString().includes(REVERT_REASON)).equal(true)
		}
	});


	after( async () => {
    });

});

// old : 0x000d01e1338001e13380000000010000000000000000000f424007ae147b4254435553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4554485553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4441495553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b5a52585553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4241545553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4b4e435553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4c494e4b55534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b434f4d5055534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b444f474555534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b5348494255534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b5452585553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b444f545553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424000000064534f4c2d5553440000000000c6c40c6b5466c5dc1acd3a7e4047be7a02b35f6800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// new : 0x000d01e1338001e13380000000010000000000000000000f424007ae147b4254435553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4554485553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4441495553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b5a52585553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4241545553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4b4e435553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b4c494e4b55534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b434f4d5055534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b444f474555534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b5348494255534443000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b5452585553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424007ae147b444f545553444300000000009158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d669158e94270fee7cb6749a77be2d65e40d56c8d6600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f424000000064534f4c2d5553440000000000c6c40c6b5466c5dc1acd3a7e4047be7a02b35f6800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
// 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000